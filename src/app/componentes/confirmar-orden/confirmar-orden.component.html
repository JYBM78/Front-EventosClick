<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Confirmación de Orden</title>
  <link
    href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css"
    rel="stylesheet"
  />
</head>
<body>
  <div class="container mt-5" *ngIf="carritoCompra">
    <div class="card">
      <div class="card-header text-center bg-light">
        <h2 class="text-primary">Confirmación de Orden</h2>
      </div>

      <div class="card-body">
        <p><strong>ID del carrito:</strong> {{ idCarrito }}</p>

        <!-- Iterar sobre los items del carrito -->
        <div
          *ngFor="let item of carritoCompra.items"
          class="border p-3 mb-3 rounded shadow-sm"
        >
          <h5 class="text-secondary">
            <strong>Evento:</strong>
            {{ nombresEventos.get(item.idEvento) || 'Evento desconocido' }}
          </h5>
          <p><strong>Localidad:</strong> {{ item.nombreLocalidad }}</p>
          <p><strong>Unidades:</strong> {{ item.cantidad }}</p>
          <p><strong>Precio individual:</strong> ${{ preciosItem.get(item.idEvento) }}</p>
          <p><strong>Subtotal:</strong> ${{ obtenerPrecioMap(item).toFixed(2) }}</p>

          <!-- Mostrar sillas seleccionadas en fila -->
          <div *ngIf="item.sillasSeleccionadas.length > 0" class="mt-3">
            <p><strong>Sillas seleccionadas:</strong></p>
            <div class="d-flex flex-wrap gap-2">
              <span
                *ngFor="let silla of item.sillasSeleccionadas"
                class="badge bg-info text-dark px-3 py-2"
              >
                 {{ silla }}
              </span>
            </div>
          </div>
        </div>

        <!-- Total pagado calculado -->
        <p class="mt-3"><strong>Total Pagado:</strong> ${{ calcularTotalPagado(carritoCompra.items) }}</p>

        <!-- Totales después de aplicar el cupón -->
        <div class="d-flex justify-content-between">
          <p><strong>Total Final:</strong> ${{ obtenerValorFinal() }}</p>
        </div>

        <!-- Botones de acción -->
        <div class="d-grid gap-2 mt-4">
          <button
            class="btn btn-success"
            (click)="crearOrden()"
            [disabled]="idOrden"
          >
            Crear Orden
          </button>

          <button
            class="btn btn-primary"
            (click)="confirmarPago()"
            [disabled]="!idOrden"
          >
            Pagar Orden
          </button>
        </div>
      </div>
    </div>
  </div>

  <script src="https://cdn.jsdelivr.net/npm/@angular/core@latest"></script>
</body>
</html>
